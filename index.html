<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/x-icon" href="static/favicon.ico"/>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RNDM Terminal</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet"/>
  <audio id="beep-ok" src="static/beep-ok.wav" preload="auto"></audio>
  <audio id="beep-err" src="static/beep-err.wav" preload="auto"></audio>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
  <div class="bootup">
    <p class="typewriter">[ booting rndm://terminal... ]</p>
  </div>

  <div class="terminal hidden">
    <pre class="ascii">
██████╗ ███╗   ██╗██████╗ ███╗   ███╗
██╔══██╗████╗  ██║██╔══██╗████╗ ████║
██████╔╝██╔██╗ ██║██║  ██║██╔████╔██║
██╔═╗██╗██║╚██╗██║██║  ██║██║╚██╔╝██║
██║ ╚██║██║ ╚████║██████╔╝██║ ╚═╝ ██║
╚═╝  ╚═╝╚═╝  ╚═══╝╚═════╝ ╚═╝     ╚═╝
    </pre>

    <div class="info">
      <p class="username blink-cursor">[ robbie@rndm ~ ]$</p>
      <p>Welcome to the digital domain. Type <code>help</code> to begin.</p>
    </div>

    <div class="links">
      <p><span class="label">>_ github</span> — <a href="https://github.com/archirobbie">github.com/archirobbie</a></p>
      <p><span class="label">>_ youtube</span> — <a href="https://youtube.com/@ArchiRobbie">youtube.com/@ArchiRobbie</a></p>
      <p><span class="label">>_ twitch</span> — <a href="https://twitch.tv/archirobbie">twitch.tv/archirobbie</a></p>
      <p><span class="label">>_ kick</span> — <a href="https://kick.com/archirobbie">kick.com/archirobbie</a></p>
      <p><span class="label">>_ tiktok</span> — <a href="https://tiktok.com/@archirobbie">tiktok.com/@archirobbie</a></p>
      <p><span class="label">>_ threads</span> — <a href="https://threads.net/@archirobbie">threads.net/@archirobbie</a></p>
      <p><span class="label">>_ email</span> — <a href="mailto:robbie@rndm.site">robbie@rndm.site</a></p>
      <p><span class="label">>_ instagram</span> — <a href="https://instagram.com/archirobbie">instagram.com/archirobbie</a></p>
      <p><span class="label">>_ wishlist --steam</span> — <a href="https://store.steampowered.com/wishlist/id/archirobbie">Steam</a></p>
      <p><span class="label">>_ wishlist --amazon</span> — <a href="https://www.amazon.com.mx/hz/wishlist/ls/343UWGK9AZPXE?ref_=wl_share" target="_blank">Amazon</a> <span style="color:#ffb347;font-size:0.95em;">(MXN, Prime shipping)</span></p>
      <p><span class="label">>_ support --coffee</span> — <a href="https://ko-fi.com/archirobbie">ko-fi.com/archirobbie</a></p>
      <p><span class="label">>_ discord</span> — <a href="https://discord.gg/sr7xVuWsAN" target="_blank">discord.gg/sr7xVuWsAN</a></p>
    </div>

    <div class="terminal-input">
      <span class="prompt-label">[ guest@rndm ~ ]$</span>
      <input type="text" id="terminal-cmd" autocomplete="off" placeholder="Type a command..." />
    </div>
    <pre id="terminal-output"></pre>
  </div>

  <div id="reflection"></div>
  <div id="crt-vignette"></div>
  <div id="matrix-overlay" style="display:none; position:fixed; inset:0; z-index:9999; pointer-events:none;"></div>
  <audio id="chiptune" src="static/chiptune.mp3"></audio>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    const bootup = document.querySelector('.bootup');
    const terminal = document.querySelector('.terminal');
    const messages = [
      '[ booting rndm://terminal... ]',
      '[ loading kernel modules... ]',
      '[ initializing CRT display... ]',
      '[ mounting /home/robbie ]',
      '[ loading assets... ]',
      '[ system ready. welcome! ]'
    ];
    let i = 0;
    function nextMsg() {
      if (i < messages.length) {
        bootup.querySelector('.typewriter').textContent = messages[i];
        i++;
        setTimeout(nextMsg, 900);
      } else {
        bootup.style.display = 'none';
        terminal.classList.remove('hidden');
      }
    }
    terminal.classList.add('hidden');
    bootup.style.display = 'flex';
    nextMsg();
  });

  // Typewriter effect for terminal output
  function typeWriterEffect(element, text, speed = 18, cb) {
  let i = 0;
  function type() {
    if (i < text.length) {
      if (text[i] === '<') {
        // Find the end of the tag
        const end = text.indexOf('>', i) + 1;
        if (end > i) {
          element.innerHTML += text.slice(i, end);
          i = end;
        } else {
          // Fallback in case of malformed HTML
          element.innerHTML += text.charAt(i);
          i++;
        }
      } else {
        element.innerHTML += text.charAt(i) === '\n' ? '<br>' : text.charAt(i);
        i++;
      }
      setTimeout(type, speed);
    } else if (cb) {
      cb();
    }
  }
  type();
}

  // Social links for the 'links' command
  const socialLinks = [
    { label: 'github', url: 'https://github.com/archirobbie', icon: 'fab fa-github' },
    { label: 'youtube', url: 'https://youtube.com/@ArchiRobbie', icon: 'fab fa-youtube' },
    { label: 'twitch', url: 'https://twitch.tv/archirobbie', icon: 'fab fa-twitch' },
    { label: 'kick', url: 'https://kick.com/archirobbie', icon: 'fa-solid fa-gamepad' },
    { label: 'tiktok', url: 'https://tiktok.com/@archirobbie', icon: 'fab fa-tiktok' },
    { label: 'threads', url: 'https://threads.net/@archirobbie', icon: 'fa-brands fa-threads' },
    { label: 'discord', url: 'https://discord.gg/sr7xVuWsAN', icon: 'fab fa-discord' },
    { label: 'email', url: 'mailto:robbie@rndm.site', icon: 'fa-solid fa-envelope' },
    { label: 'instagram', url: 'https://instagram.com/archirobbie', icon: 'fab fa-instagram' },
    { label: 'steam', url: 'https://store.steampowered.com/wishlist/id/archirobbie', icon: 'fab fa-steam' },
    { label: 'ko-fi', url: 'https://ko-fi.com/archirobbie', icon: 'fa-solid fa-mug-hot' },
    { label: 'podcast', url: 'https://www.youtube.com/playlist?list=PL6dmNeBlCqByH3-fW-4GzM0sDyQmBuX9d', icon: 'fa-solid fa-podcast', text: 'Design Imperative' },
    { label: 'amazon', url: 'https://www.amazon.com.mx/hz/wishlist/ls/343UWGK9AZPXE?ref_=wl_share', icon: 'fab fa-amazon', text: 'Amazon <span style="color:#ffb347;font-size:0.95em;">(MXN, Prime shipping)</span>' }
  ];

  let currentDir = '~';
  const fakeFS = {
    '~': ['projects', 'music', 'about.txt', 'secret.cat'],
    projects: ['rndm-site', 'ascii-art', 'matrix.js'],
    music: ['chiptune.mp3', 'synthwave.mp3']
  };

  function handleFSCommand(cmd) {
    if (cmd === 'ls') {
      return fakeFS[currentDir].join('  ');
    }
    if (cmd.startsWith('cd ')) {
      const dir = cmd.split(' ')[1];
      if (fakeFS[dir]) {
        currentDir = dir;
        return `moved to ${dir}`;
      } else {
        return `no such directory: ${dir}`;
      }
    }
    if (cmd.startsWith('cat ')) {
      const file = cmd.split(' ')[1];
      if (currentDir === '~' && file === 'about.txt') {
        return 'This is the RNDM digital domain. Welcome!';
      }
      if (currentDir === '~' && file === 'secret.cat') {
        return asciiEggs.cat;
      }
      return `cannot open ${file}`;
    }
    return null;
  }

  const asciiEggs = {
    cat: `
        /\\_/\\  
       ( o.o ) 
        > ^ <`,
    dog: `
        /^ ^\\
       / 0 0 \\
       V\\ Y /V
        / - \\
        |    \\
        || (__V`,
    robot: `
       [::]
      .-'''''-.
     /         \\
    |  .--. .--.|
    | (    Y   )|
     \\ '.___.' /
      '-.____.-'`
  };

  const cmdInput = document.getElementById('terminal-cmd');
  const output = document.getElementById('terminal-output');
  if (cmdInput) {
    cmdInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        const val = cmdInput.value.trim();
        if (!val) return;
        cmdInput.disabled = true;
        output.innerHTML = '';
        typeWriterEffect(output, `[ guest@rndm ~ ]$ ${val}\n`, 12, () => {
          let handled = false;

          // Easter eggs (cat, dog, robot)
          if (asciiEggs[val.toLowerCase()]) {
            handled = true;
            typeWriterEffect(output, asciiEggs[val.toLowerCase()] + '\n', 6, () => {
              cmdInput.disabled = false; cmdInput.value = '';
            });
            return; // Prevent further handling
          }

          // Skills command
          if (val.toLowerCase() === 'skills') {
            handled = true;
            typeWriterEffect(
              output,
              "Architect with a passion for VR spatial design using Unity with a background in fashion photography and graphic design. If you imagine it I can try and build it.\n",
              12,
              () => { cmdInput.disabled = false; cmdInput.value = ''; }
            );
            return;
          }

          // Podcast
          else if (val.toLowerCase() === 'podcast') {
            handled = true;
            output.innerHTML +=
              'Design Imperative on YouTube: <a class="terminal-link" href="https://www.youtube.com/playlist?list=PL6dmNeBlCqByH3-fW-4GzM0sDyQmBuX9d" target="_blank">Open Playlist</a><br>';
            cmdInput.disabled = false;
            cmdInput.value = '';
            cmdInput.focus();
            return;
          }
          // Links
          else if (val.toLowerCase() === 'links') {
            handled = true;
            function typeLinks(i = 0) {
              if (i < socialLinks.length) {
                const link = socialLinks[i];
                const display = link.text ? link.text : link.label;
                output.innerHTML += `<span class="label"><i class="${link.icon}"></i></span> <a class="terminal-link" href="${link.url}" target="_blank">${display}</a><br>`;
                setTimeout(() => typeLinks(i + 1), 60);
              } else {
                cmdInput.disabled = false;
                cmdInput.value = '';
                output.scrollTop = output.scrollHeight;
              }
            }
            typeLinks();
            return;
          }
          // Time
          else if (val.toLowerCase() === 'time') {
            handled = true;
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            typeWriterEffect(output, `Current time: ${timeStr}\n`, 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          // Weather
          else if (val.toLowerCase() === 'weather') {
            handled = true;
            typeWriterEffect(output, `Weather: [API not implemented, but it's always cyber-cool here!]\n`, 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          // Matrix
          else if (val.toLowerCase() === 'matrix') {
            handled = true;
            startMatrix();
            typeWriterEffect(output, 'Matrix effect enabled! Type "unmatrix" to stop.\n', 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          else if (val.toLowerCase() === 'unmatrix') {
            handled = true;
            stopMatrix();
            typeWriterEffect(output, 'Matrix effect disabled.\n', 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          // Chiptune
          else if (val.toLowerCase() === 'chiptune') {
            handled = true;
            const audio = document.getElementById('chiptune');
            audio.currentTime = 0;
            audio.play();
            typeWriterEffect(output, 'Playing chiptune! 🎵\n', 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          // Help/About/Clear
          else if (val.toLowerCase() === 'help') {
            handled = true;
            const response = 'Available commands: help, about, links, podcast, clear, projects, music, contact, skills, blog, stats, time, weather, chiptune, matrix, unmatrix, exit';
            typeWriterEffect(output, response + '\n', 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          else if (val.toLowerCase() === 'about') {
            handled = true;
            const aboutHTML = `
              <div class="about-img-wrap">
                <img src="static/me.jpg" alt="Robbie" class="about-img glitch-img" />
              </div>
              <div>⁰෴⁰ Architect | Unity VR world builder | Design Imperative podcast on YouTube | Streamer
                <br>RNDM Architects
                <br>EN/ESP/ITA</div>
            `;
            typeWriterEffect(output, aboutHTML + '\n', 0, () => {
              cmdInput.disabled = false;
              cmdInput.value = '';
              cmdInput.focus();
            });
            return;
          }
          else if (val.toLowerCase() === 'clear') {
            handled = true;
            output.innerHTML = '';
            cmdInput.value = '';
            cmdInput.disabled = false;
            return;
          }
          else if (val.toLowerCase() === 'projects') {
            handled = true;
            const projects = [
              { name: 'photography', desc: 'Selected photo work & experiments', link: 'https://www.instagram.com/stylecomptoir/' },
              { name: 'music', desc: 'Original tracks & sound design', link: 'https://soundcloud.com/oldscratchedvinyl' },
              { name: 'vr-space-design', desc: 'Virtual reality environments & experiences', link: null }
            ];
            let html = '';
            projects.forEach(p => {
              html += `<span class="label">&gt;_ ${p.name}</span> — ${p.desc}`;
              if (p.link) html += ` <a class="terminal-link" href="${p.link}" target="_blank">[view]</a>`;
              html += '<br>';
            });
            output.innerHTML += html;
            cmdInput.disabled = false;
            cmdInput.value = '';
            cmdInput.focus();
            return;
          }
          else if (val.toLowerCase() === 'contact') {
            handled = true;
            const contactHTML = `
              <span class="label">email</span>: <a class="terminal-link" href="mailto:robbie@rndm.site">robbie@rndm.site</a><br>
              <span class="label">discord</span>: <a class="terminal-link" href="https://discord.gg/sr7xVuWsAN" target="_blank">discord.gg/sr7xVuWsAN</a>
            `;
            typeWriterEffect(output, contactHTML, 10, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          else if (val.toLowerCase() === 'stream' || val.toLowerCase() === 'videos') {
            handled = true;
            // Mock activity for the past year
            const today = new Date();
            const days = 365;
            let activity = {};
            for (let i = 0; i < days; i++) {
              const d = new Date(today);
              d.setDate(today.getDate() - i);
              const key = d.toISOString().slice(0, 10);
              // Randomly assign activity: 5 streams/week, 3-4 uploads/week
              const weekday = d.getDay();
              if (Math.random() < 5 / 7) activity[key] = 'twitch';
              if (Math.random() < 4 / 7) activity[key] = activity[key] ? 'both' : 'youtube';
            }

            // Build grid HTML
            let html = `<div style="margin-bottom:0.5em;">Livestreams almost daily 7pm EST.</div>`;
            html += '<div class="activity-legend"><span class="twitch-block"></span> Twitch &nbsp; <span class="youtube-block"></span> YouTube</div>';
            html += '<div class="activity-grid">';
            for (let week = 0; week < 52; week++) {
              html += '<div class="activity-week">';
              for (let day = 0; day < 7; day++) {
                const d = new Date(today);
                d.setDate(today.getDate() - (week * 7 + day));
                const key = d.toISOString().slice(0, 10);
                let cls = '';
                if (activity[key] === 'twitch') cls = 'twitch-block';
                else if (activity[key] === 'youtube') cls = 'youtube-block';
                else if (activity[key] === 'both') cls = 'both-block';
                html += `<span class="activity-block ${cls}" title="${key}"></span>`;
              }
              html += '</div>';
            }
            html += '</div>';
            typeWriterEffect(output, html, 0, () => { cmdInput.disabled = false; cmdInput.value = ''; });
            return;
          }
          else if (val.toLowerCase() === 'exit') {
            handled = true;
            window.location.href = 'https://www.youtube.com/watch?v=z2AyJTOR_qw';
            return;
          }

          // Fake file system
          if (!handled) {
            const fsResponse = handleFSCommand(val);
            if (fsResponse !== null) {
              handled = true;
              typeWriterEffect(output, fsResponse + '\n', 8, () => { cmdInput.disabled = false; cmdInput.value = ''; });
              return;
            }
          }

          // Unknown command
          if (!handled) {
            playErr();
            typeWriterEffect(output, `Unknown command: ${val}\n`, 12, () => { cmdInput.disabled = false; cmdInput.value = ''; });
          } else {
            playOk();
          }

          output.scrollTo({ top: output.scrollHeight, behavior: 'smooth' });
        });
      }
    });
  }

  // Blinker stops when input is focused
  const username = document.querySelector('.username.blink-cursor');
  if (cmdInput && username) {
    cmdInput.addEventListener('focus', () => {
      username.classList.add('paused');
    });
    cmdInput.addEventListener('blur', () => {
      username.classList.remove('paused');
    });
  }

  // Reflection effect
  const reflection = document.getElementById('reflection');
  </script>

  <script>
let matrixActive = false;
let lastSpace = 0;

function startMatrix() {
  const overlay = document.getElementById('matrix-overlay');
  overlay.innerHTML = '';
  overlay.style.display = 'block';
  matrixActive = true;

  const canvas = document.createElement('canvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  overlay.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  const cols = Math.floor(canvas.width / 20);
  const drops = Array(cols).fill(1);

  function draw() {
    ctx.fillStyle = 'rgba(0,0,0,0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#00ffcc';
    ctx.font = '18px monospace';
    for (let i = 0; i < drops.length; i++) {
      const text = String.fromCharCode(0x30A0 + Math.random() * 96);
      ctx.fillText(text, i * 20, drops[i] * 20);
      if (drops[i] * 20 > canvas.height && Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
    if (overlay.style.display === 'block' && matrixActive) {
      requestAnimationFrame(draw);
    }
  }
  draw();
}

function stopMatrix() {
  matrixActive = false;
  document.getElementById('matrix-overlay').style.display = 'none';
}

// Matrix exit keys
window.addEventListener('keydown', function(e) {
  if (!matrixActive) return;
  if (
    e.key === 'Escape' ||
    e.key.toLowerCase() === 'q'
  ) {
    stopMatrix();
  }
  if e.key === ' ' {
    const now = Date.now();
    if (now - lastSpace < 400) {
      stopMatrix();
    }
    lastSpace = now;
  }
});
  </script>

  <script>
let glitchIntervals = [];

function setupGlitchEffect() {
  // Clear previous intervals
  glitchIntervals.forEach(id => clearInterval(id));
  glitchIntervals = [];

  const imgs = document.querySelectorAll('.glitch-img');
  imgs.forEach(img => {
    const intervalId = setInterval(() => {
      if (Math.random() < 0.15) { // 15% chance every 2s
        img.classList.add('glitching');
        setTimeout(() => img.classList.remove('glitching'), 500);
      }
    }, 2000);
    glitchIntervals.push(intervalId);
  });
}

// Call this after about image is rendered
const observer = new MutationObserver(() => {
  if (output.querySelector('.glitch-img')) {
    setupGlitchEffect();
  }
});
observer.observe(output, { childList: true, subtree: true });
  </script>
</body>
</html>
